<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Bohudur Payment Checkout</title>
                <base href="https://checkout.bohudur.one/">
        <link rel="stylesheet" href="style.css">
        <link rel="shortcut icon" href="images/logo.png" />
        <link rel="stylesheet" href="includes/popup-modal.css" />
    </head>
    <body>
    
        <section class="payment-section">
            <div class="container">
                <div class="payment-wrapper">
                    <div class="payment-left">
                        <div class="payment-header">
                            <div class="payment-header-icon" style="width: 48px;height: 48px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-lightning-charge" viewBox="0 0 16 16">
                                    <path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09zM4.157 8.5H7a.5.5 0 0 1 .478.647L6.11 13.59l5.732-6.09H9a.5.5 0 0 1-.478-.647L9.89 2.41z"/>
                                </svg>
                            </div>
                            <div class="payment-header-title">Order Summary</div>
                            <p id="welcome_text" class="payment-header-description">Hello Afzal islam, complete payment using Bohudur.</p>
                        </div>
                        <div class="payment-content">
                            <div class="payment-body">
                                <div class="payment-plan">
                                    <div class="payment-plan-type">
                                        <img src="images/logo.png" height="28px" width="28px">
                                    </div>
                                    <div class="payment-plan-info">
                                        <div id="product_name" class="payment-plan-info-name">vexzomart</div>
                                        <div id="product_price" class="payment-plan-info-price">Amount: ৳1</div>
                                    </div>
                                    <span id="cancel-payment" style="color:red" class="payment-plan-change">Cancel</span>
                                </div>
                                <div class="payment-summary">
                                                                    <div class="payment-summary-item">
                                        <div class="payment-summary-name">Additional fee</div>
                                        <div id="fee" class="payment-summary-price">৳0</div>
                                    </div>
                                    <div class="payment-summary-divider"></div>
                                    <div class="payment-summary-item payment-summary-total">
                                        <div class="payment-summary-name">Total</div>
                                        <div id="total" class="payment-summary-price">৳1                                       </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="payment-right">
                        <div action="" class="payment-form">
                            <h1 class="payment-title">Pay Using-</h1>
                            <div class="payment-method">
                                <input type="radio" name="payment-method" id="bkash" />
                                  <label for="bkash" class="payment-method-item" onclick="showPaymentDetails('bkash')">
                                    <img src="images/bkash.png" alt="BKash" />
                                  </label>
                                                            </div>
                            <div class="payment-details" id="bkashDetails">
                                    <button id="bKash_merchant" type="submit" class="payment-form-submit-button">
                                        <img src="pay.svg" alt="icon" style="margin: -5px; padding-right: 10px;" /> Pay Now
                                    </button></div>                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="blur-layer" id="blur-layer"></div>
        <div class="popup-overlay" id="popup-layout">
            <div id="popup_background" class="popup-content">
                <div class="img-div" style="background: #fff">
                    <img src="" height="115x" width="100%" style="border-radius: 10px; margin-bottom: -5px;" id="banner" alt="" />
                </div>
                <div class="input_step_confirmn">
                    <ul class="all_step">
                        <li class="li_row">
                            <p id="step_1" style="text-align: left"></p>
                        </li>
                        <hr/>
                        <li class="li_row">
                            <p><span class="marked_text"></span> -এ ক্লিক করুন।</p>
                        </li>
                        <hr/>
                        <li class="li_row">
                            <p class="text-left">
                                এই নম্বরটি প্রাপক নম্বর হিসেবে লিখুনঃ
                                <span id="number_label" class="marked_text"></span>
                                <a href="#" style="background-color: #970006;" onclick="copyContents(event, this)" id="number_copy"> <img src="copy.svg" alt="icon" style="margin: 5px;" /> </a>
                            </p>
                        </li>
                        <hr/>
                        <li class="li_row">
                            <p class="text-left">মোট টাকার পরিমাণঃ <span id="amount2" class="marked_text">1.00</span></p>
                        </li>
                        <hr />
                        <li class="li_row">
                            <p id="step_5"></p>
                        </li>
                    </ul>
                    <p id="titless">ট্রান্সজেকশন আইডি দিন</p>
                    <div id="flexs">
                        <input type="text" placeholder="ট্রান্সজেকশন আইডি দিন" id="trx" autocomplete="off" maxlength="15" minlength="6" />
                    </div>
                    <div class="btn_action">
                        <button style="outline: none;" onclick="popup.close()">CANCEL</button>
                        <button id="submit" style="outline: none;">CONFIRM</button>
                    </div>
                </div>
            </div>
        </div>
        
        <script type="text/javascript" src="includes/popup-modal.js"></script>
        <script type="text/javascript" src="includes/toaster.js"></script>
        <script type="text/javascript" src="includes/loading.js"></script>
        
        <script>
        const PAYMENT_KEY = 'DzxRs3qUxTmK3LvYnpQW';

        var bkashSteps = {"step_1":"*247# ডায়াল করে আপনার BKASH অ্যাপে অথবা BKASH মোবাইল মেনুতে যান।","method":"\"Send Money\"","number":"01316506540","step_5":"নিশ্চিত করতে এখন আপনার BKASH পিন লিখুন।","background":"#e2136e","copy_btn_color":"#9B1D55","img":"images\/bkash-payment.png"};document.getElementById("bKash_merchant").onclick = () => open("bkash");        
                
        const popup = new Popup("blur-layer", "popup-layout");
        var payment_method = '';
        
        function showPaymentDetails(paymentMethod) {
            var paymentDetails = document.getElementsByClassName("payment-details");
            for (var i = 0; i < paymentDetails.length; i++) {
                paymentDetails[i].style.display = "none";
            }

            document.getElementById(paymentMethod + "Details").style.display = "block";
        }

        function open(method) {
            const stepsMap = {
              bkash: typeof bkashSteps !== 'undefined' ? bkashSteps : undefined,
              nagad: typeof nagadSteps !== 'undefined' ? nagadSteps : undefined,
              rocket: typeof rocketSteps !== 'undefined' ? rocketSteps : undefined,
              upay: typeof upaySteps !== 'undefined' ? upaySteps : undefined,
            };
            
            var data = stepsMap[method] || {};
            payment_method = method;
            document.getElementById("step_1").textContent = data.step_1;
            document.getElementById("number_label").textContent = data.number;
            document.getElementsByClassName("marked_text")[0].textContent = data.method;
            document.getElementById("step_5").textContent = data.step_5;
            document.getElementById("popup_background").style.background = data.background;
            document.getElementById("number_copy").style.background = data.copy_btn_color;
            document.getElementById("number_copy").setAttribute("href", data.number);
            document.getElementById("banner").setAttribute("src", data.img);
            popup.open();
        }

                                    
        function copyContents(event, element) {
            event.preventDefault();
            const textToCopy = element.getAttribute('href');
            const tempTextArea = document.createElement("textarea");
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand("copy");
            document.body.removeChild(tempTextArea);
            
            Toast("Number Copied");
        }

        function showErrorToast(message){
            ToastifyLite({
                message: message,
                duration: 3000,
                backgroundColor: "red",
                textColor: "#fff",
            });
        }

        function Toast(message){
            ToastifyLite({
                message: message,
                duration: 3000,
                backgroundColor: "#FFC107",
                textColor: "#fff",
            });
        }

        function sendRequest(method, url, callback, data = null) {
            const xhr = new XMLHttpRequest();
            xhr.open(method, "https://checkout.bohudur.one/" + url, true);
            
            xhr.responseType = "json";
            xhr.onloadstart = showLoading;
            
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    hideLoading();
                    if (xhr.status >= 200 && xhr.status < 300) {
                        callback(null, xhr.response);
                    } else {
                        callback(new Error(`Request failed with status ${xhr.status}`));
                    }
                }
            };
            
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(data ? JSON.stringify(data) : null);
        }

        function redirectWithPost(url, key) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = url;
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'payment_key';
            input.value = key;
            form.appendChild(input);
            document.body.appendChild(form);
            form.submit();
        }
    
        document.addEventListener("DOMContentLoaded", (event) => {
            document.getElementById("submit").addEventListener("click", function(){
                var trx = document.getElementById('trx').value;
                if (trx.length < 6 || trx.length > 15) {
                    showErrorToast("Wrong Transaction ID!");
                } else {
                    var data = {
                        'csrf_token': "RUJcEUJZQkZEXA==",
                        'payment-method': payment_method,
                        'payment-key': PAYMENT_KEY,
                        'trx': trx
                    };
                    
                    sendRequest('POST', 'verify.php', (err, response) => {
                        if (!err) {
                            if (response.responseCode == 700 && response.status == "completed") {
                                if (response.redirect) {
                                    redirectWithPost(response.redirect, PAYMENT_KEY);                                }
                            } else {
                                showErrorToast(response.message);
                            }
                        }
                    }, data);
                }
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("cancel-payment").addEventListener("click", function () {
                var data = {
                    "payment-key": PAYMENT_KEY,
                    "csrf_token": "RUJcEUJZQkZEXA=="
                };
                
                sendRequest('POST', 'cancel.php', (err, response) => {
                    if (!err) {
                        if (response.responseCode == 200 && response.status === "success") {
                            redirectWithPost(response.redirect,PAYMENT_KEY);                        } else {
                            showErrorToast(response.message);
                        }
                    }else{
                        showErrorToast(response.message);
                    }
                }, data);
            });
        });
        
                </script>
    </body>
</html>
